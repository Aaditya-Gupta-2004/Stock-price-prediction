<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StockAI - Smart Stock Predictor</title>

  <!-- Bootstrap & Chart.js -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      font-family: "Poppins", sans-serif;
      color: #f8f9fa;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      overflow-x: hidden;
    }

    .container {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 1400px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    h2 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    p {
      color: #adb5bd;
      margin-bottom: 2rem;
    }

    .input-group input {
      border-radius: 30px 0 0 30px;
      padding: 0.9rem 1.2rem;
      border: none;
    }

    .input-group button {
      border-radius: 0 30px 30px 0;
      background-color: #0d6efd;
      border: none;
    }

    .input-group button:hover {
      background-color: #0b5ed7;
      transform: scale(1.05);
    }

    /* Autocomplete dropdown */
    .autocomplete-items {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 0 0 15px 15px;
      width: 100%;
      z-index: 10;
      max-height: 200px;
      overflow-y: auto;
      backdrop-filter: blur(10px);
    }

    .autocomplete-item {
      padding: 8px 12px;
      cursor: pointer;
      color: #fff;
    }

    .autocomplete-item:hover {
      background: rgba(13, 110, 253, 0.7);
    }

    #realtimePrice {
      font-size: 1.4rem;
      margin-top: 1.5rem;
      font-weight: 500;
    }

    .price-up {
      color: #28a745;
    }

    .price-down {
      color: #dc3545;
    }

    .chart-container {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 1rem;
    }

    .row-charts {
      display: flex;
      flex-wrap: nowrap;
      justify-content: space-between;
      gap: 1.5rem;
    }

    .small-chart {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 1.2rem;
    }

    .small-chart canvas {
      width: 100% !important;
      height: 360px !important;
    }

    #liveChart {
      width: 100%;
      height: 450px !important;
    }

    .right-panel {
      width: 400px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      padding: 1rem 1.2rem;
      height: 420px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .price-item {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.5rem 0;
      font-size: 1.05rem;
    }

    #loadingSpinner {
      display: none;
    }

    .news-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 1.5rem;
      margin-top: 2rem;
      width: 100%;
    }

    .news-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 0.5rem;
    }

    .news-item img {
      width: 80px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
    }

    .news-item a {
      color: #f8f9fa;
      text-decoration: none;
    }

    .news-item a:hover {
      text-decoration: underline;
      color: #0dcaf0;
    }



    .price-item {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.5rem 0;
      font-size: 1.05rem;
      animation: fadeInPrice 0.9s ease-in;
    }

    @keyframes fadeInPrice {
      from {
        opacity: 0;
        transform: translateY(5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <div class="container text-center">
    <h2>üìà StockAI - Smart Stock Predictor</h2>
    <p>Analyze real-time and predicted stock prices using AI models (MA, ARMA, ARIMA)</p>

    <!-- üîç Search Bar -->
    <div class="mb-3 mt-4 position-relative" style="max-width:400px;margin:0 auto;">
      <div class="input-group">
        <input type="text" id="symbolInput" class="form-control" placeholder="Enter stock symbol (e.g., AAPL, TSLA)" autocomplete="off" />
        <button class="btn btn-primary" onclick="fetchStockData()">Predict</button>
      </div>
      <div id="autocompleteList" class="autocomplete-items"></div>
    </div>

    <div class="d-flex justify-content-center mt-3">
      <div class="spinner-border text-light" id="loadingSpinner" role="status"></div>
    </div>

    <div class="main-content mt-4 d-flex gap-3">
      <div class="flex-grow-1">
        <h4 id="realtimePrice">Current Price: --</h4>
        <div class="chart-container"><canvas id="liveChart"></canvas></div>

        <div class="row-charts mt-3">
          <div class="small-chart"><canvas id="maChart"></canvas></div>
          <div class="small-chart"><canvas id="armaChart"></canvas></div>
          <div class="small-chart"><canvas id="arimaChart"></canvas></div>
        </div>

        <div class="news-section text-start">
          <h4>üì∞ Recent News</h4>
          <div id="newsContainer">Fetching news...</div>
        </div>
      </div>

      <div class="right-panel">
        <h5>Live Prices</h5>
        <div id="samplePrices"></div>
      </div>
    </div>

    <footer class="mt-4">
      <p>Powered by <strong>FastAPI</strong> | Built with ‚ù§Ô∏è by <strong>StockAI</strong></p>
    </footer>
    <footer class="mt-4">
      <p>This AI stock prediction model may make mistakes. Predictions are generated using historical data and
        statistical models ‚Äî they are not guaranteed to be accurate. Please use the results for educational and research
        purposes only, not for actual trading or investment decisions.</p>
    </footer>
  </div>

  <script>
    const backendURL = "http://127.0.0.1:8000";
    const MARKET_AUX_API = "v2Nc4wy7CsNzinEE7IDfbtHLI2lHclRErZjMUZyO";

    const stockList =  [
      { symbol: "AAPL", name: "Apple Inc." },
      { symbol: "MSFT", name: "Microsoft Corporation" },
      { symbol: "GOOG", name: "Alphabet Inc. (Google)" },
      { symbol: "AMZN", name: "Amazon.com Inc." },
      { symbol: "TSLA", name: "Tesla Inc." },
      { symbol: "META", name: "Meta Platforms Inc. (Facebook)" },
      { symbol: "NVDA", name: "NVIDIA Corporation" },
      { symbol: "NFLX", name: "Netflix Inc." },
      { symbol: "INTC", name: "Intel Corporation" },
      { symbol: "AMD", name: "Advanced Micro Devices" },
      { symbol: "BABA", name: "Alibaba Group" },
      { symbol: "DIS", name: "Walt Disney Co." },
      { symbol: "PYPL", name: "PayPal Holdings" },
      { symbol: "ADBE", name: "Adobe Inc." },
      { symbol: "PEP", name: "PepsiCo Inc." },
      { symbol: "KO", name: "Coca-Cola Company" },
      { symbol: "WMT", name: "Walmart Inc." },
      { symbol: "JPM", name: "JPMorgan Chase & Co." },
      { symbol: "NKE", name: "Nike Inc." },
      { symbol: "SONY", name: "Sony Group Corporation" }
    ];
    const input = document.getElementById("symbolInput");
    const list = document.getElementById("autocompleteList");

    input.addEventListener("input", function () {
      const query = this.value.trim().toLowerCase();
      list.innerHTML = "";
      if (!query) return;

      const filtered = stockList.filter(
        s => s.symbol.toLowerCase().includes(query) || s.name.toLowerCase().includes(query)
      );

      filtered.forEach(stock => {
        const div = document.createElement("div");
        div.className = "autocomplete-item";
        div.innerHTML = `<strong>${stock.symbol}</strong> ‚Äì ${stock.name}`;
        div.onclick = () => {
          input.value = stock.symbol;
          list.innerHTML = "";
          fetchStockData();
        };
        list.appendChild(div);
      });
    });

    document.addEventListener("click", (e) => {
      if (e.target !== input) list.innerHTML = "";
    });

    // ========== Existing JS (unchanged below) ==========
    let maChart, armaChart, arimaChart, liveChart, liveInterval;

    async function fetchStockData() {
      const symbol = input.value.trim().toUpperCase();
      const spinner = document.getElementById("loadingSpinner");
      const priceElement = document.getElementById("realtimePrice");
      if (!symbol) return alert("‚ö†Ô∏è Please enter a stock symbol!");
      spinner.style.display = "inline-block";
      try {
        const [predRes, realRes] = await Promise.all([
          fetch(`${backendURL}/predict/${symbol}`),
          fetch(`${backendURL}/realtime/${symbol}`)
        ]);
        if (!predRes.ok || !realRes.ok) throw new Error("Backend not reachable");
        const predData = await predRes.json();
        const realData = await realRes.json();
        const price = realData.current;
        const prevClose = realData.prev_close || price;
        const changeClass = price - prevClose >= 0 ? "price-up" : "price-down";
        priceElement.innerHTML = `Current Price (${symbol}): <span class="${changeClass}">$${price.toFixed(2)}</span>`;
        renderCharts(predData);
        setupLiveChart(symbol, price);
        fetchNews(symbol);
      } catch (err) {
        console.error("‚ùå Error fetching stock data:", err);
        alert("‚ùå Failed to fetch data. Check backend or internet connection.");
      } finally {
        spinner.style.display = "none";
      }
    }

    function renderCharts(data) {
      const labels = Array.from({ length: data.MA_Prediction.length }, (_, i) => `Day ${i + 1}`);
      const makeChart = (id, title, color, dataset) => {
        const ctx = document.getElementById(id).getContext("2d");
        return new Chart(ctx, {
          type: "line",
          data: { labels, datasets: [{ label: title, data: dataset, borderColor: color, borderWidth: 2, fill: false }] },
          options: {
            plugins: { legend: { labels: { color: "#fff" } } },
            scales: { x: { ticks: { color: "#adb5bd" } }, y: { ticks: { color: "#adb5bd" } } }
          }
        });
      };
      maChart?.destroy(); armaChart?.destroy(); arimaChart?.destroy();
      maChart = makeChart("maChart", "MA Prediction", "#0dcaf0", data.MA_Prediction);
      armaChart = makeChart("armaChart", "ARMA Prediction", "#20c997", data.ARMA_Prediction);
      arimaChart = makeChart("arimaChart", "ARIMA Prediction", "#ffc107", data.ARIMA_Prediction);
    }

    function setupLiveChart(symbol, initialPrice) {
      if (liveChart) liveChart.destroy();
      if (liveInterval) clearInterval(liveInterval);
      const ctx = document.getElementById("liveChart").getContext("2d");
      const chartData = { labels: [new Date().toLocaleTimeString()], datasets: [{ label: `${symbol} Live`, data: [initialPrice], borderColor: "#0dcaf0", borderWidth: 2, fill: false }] };
      liveChart = new Chart(ctx, { type: "line", data: chartData, options: { scales: { x: { ticks: { color: "#adb5bd" } }, y: { ticks: { color: "#adb5bd" } } } } });
      liveInterval = setInterval(async () => {
        try {
          const res = await fetch(`${backendURL}/realtime/${symbol}`);
          const d = await res.json();
          const price = d.current;
          const time = new Date().toLocaleTimeString();
          chartData.labels.push(time);
          chartData.datasets[0].data.push(price);
          if (chartData.labels.length > 25) { chartData.labels.shift(); chartData.datasets[0].data.shift(); }
          liveChart.update();
        } catch (err) {
          console.error("‚ö†Ô∏è Live update error:", err);
        }
      }, 5000);
    }

    async function fetchNews(symbol) {
      const container = document.getElementById("newsContainer");
      container.innerHTML = "<p>Loading recent news...</p>";
      try {
        const res = await fetch(`https://api.marketaux.com/v1/news/all?symbols=${symbol}&filter_entities=true&language=en&limit=5&api_token=${MARKET_AUX_API}`);
        const data = await res.json();
        if (!data.data?.length) { container.innerHTML = "<p>No recent news found.</p>"; return; }
        container.innerHTML = data.data.map(n => `
          <div class="news-item">
            <img src="${n.image_url || 'https://via.placeholder.com/80x60'}" />
            <div><a href="${n.url}" target="_blank">${n.title}</a><small>${new Date(n.published_at).toLocaleString()}</small></div>
          </div>
        `).join("");
      } catch (err) {
        console.error("üì∞ News fetch error:", err);
        container.innerHTML = "<p>Error loading news.</p>";
      }
    }

    function updateSamplePrices() {
  const sampleList = document.getElementById("samplePrices");

  // Big pool of symbols to rotate through
  const allSymbols = [
    "AAPL","TSLA","GOOG","MSFT","AMZN","NVDA","META","NFLX",
    "IBM","INTC","ORCL","ADBE","PYPL","CRM","AMD","SHOP",
    "RELIANCE","TCS","INFY","HDFCBANK","ICICIBANK","SBIN","ITC","LT"
  ];

  // Pick 8 random symbols each cycle
  const selected = allSymbols.sort(() => 0.5 - Math.random()).slice(0, 8);

  // Render prices
  sampleList.innerHTML = selected.map((sym, i) => {
    const price = (Math.random() * 500 + 100).toFixed(2);
    const color = Math.random() > 0.5 ? "price-up" : "price-down";
    return `<div class="price-item" style="animation-delay:${i * 0.1}s">
              <span>${sym}</span>
              <span class="${color}">$${price}</span>
            </div>`;
  }).join("");
}

// update both symbols & prices every 2 sec
setInterval(updateSamplePrices, 2000);

window.onload = () => {
  updateSamplePrices();
  input.value = "AAPL";
  fetchStockData();
};


    setInterval(updateSamplePrices, 2000);
    window.onload = () => {
      updateSamplePrices();
      input.value = "AAPL";
      fetchStockData();
    };
  </script>
</body>

</html>
